{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-J2MXTGJ8DT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-J2MXTGJ8DT');
</script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="shortcut icon" href="{% static 'icons/favicon.png' %}" type="image/x-icon">
  <title>Bellafly</title>
</head>
<body>
  <header>
    <h1>🦋 Bellafly 🦋</h1>
  </header>

  <button class="menu-toggle" onclick="toggleMenu()">☰</button>
  
  <div class="overlay" id="overlay" onclick="closeMenu()"></div>

  <nav id="menu" class="sidebar">
    <div class="sidebar-title">Categorias</div>
    <a class="btn {% if categoria == 'perfumaria' %}active{% endif %}" href="?categoria=perfumaria" data-category="perfumaria">
      <span>✨ Perfumaria</span>
    </a>
    {% comment %} <a class="btn {% if categoria == 'roupas' %}active{% endif %}" href="?categoria=roupas" data-category="roupas">
      <span>👗 Roupas</span>
    </a>
    <a class="btn {% if categoria == 'conjuntos' %}active{% endif %}" href="?categoria=conjuntos" data-category="conjuntos">
      <span>👚 Conjuntos de Roupas</span>
    </a> {% endcomment %}
    <a class="btn {% if categoria == 'kits' %}active{% endif %}" href="?categoria=kits" data-category="kits">
      <span>💄 Kits de Beleza</span>
    </a>
    <a class="btn {% if categoria == 'diversos' %}active{% endif %}" href="?categoria=diversos" data-category="diversos">
      <span>🛍️ diversos</span>
    </a>
  </nav>
  
  <section class="products">
    {% for produto in produtos %}
      {% if produto.ativo == True %}
        <div class="card">
          <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }} image">
          <h2>{{ produto.nome }}</h2>
          <p>{{ produto.descricao }}</p>
          <div class="price">R$ {{ produto.preco }}</div>
          <div class="price">Disponível: {{ produto.quantidade_estoque }}</div>
          <a class="btn" href="https://wa.me/557981718236?text=Olá,+tenho+interesse+no+{{ produto.nome|urlencode }}" target="_blank">💬 Comprar pelo WhatsApp</a>
          <a class="btn add-to-cart" data-nome="{{ produto.nome }}" data-preco="{{ produto.preco|floatformat:2 }}">🛒 Adicionar ao Carrinho</a>
        </div>
      {% endif %}
    {% empty %}
    <div style="text-align:center; width:100%;">Nenhum produto encontrado nesta categoria.</div>
    {% endfor %}
  </section>

  <!-- Botão flutuante do carrinho -->
  <div id="cart-icon" onclick="toggleCart()">
    🛒 <span id="cart-count">0</span>
  </div>

  <!-- Sidebar do carrinho -->
  <div id="cart-sidebar">
    <h2>🛍️ Carrinho</h2>
    <div id="cart-items"></div>
    <div id="cart-total"></div>
    <button class="btn" onclick="sendCartToWhatsApp()">💬 Enviar Pedido no WhatsApp</button>
    <p><br></p>
    <button class="btn" onclick="clearCart()">🗑️ Limpar Carrinho</button>
  </div>
  <div id="cart-overlay" onclick="toggleCart()"></div>

  <footer>
    <a class="btn" href="{% url 'admin:index' %}" target="_blank">🔐 Login Admin</a>
    <p>contato@omnisistems.com.br</p>
  </footer>

  <script>
    // Menu lateral
    function toggleMenu() {
      const menu = document.getElementById("menu");
      const overlay = document.getElementById("overlay");
      menu.classList.toggle("show");
      overlay.classList.toggle("show");
    }
    function closeMenu() {
      document.getElementById("menu").classList.remove("show");
      document.getElementById("overlay").classList.remove("show");
    }

    // -------------------------
    // CARRINHO
    // -------------------------
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function renderCart() {
      const cartItems = document.getElementById("cart-items");
      const cartTotal = document.getElementById("cart-total");
      const cartCount = document.getElementById("cart-count");
      cartItems.innerHTML = "";

      if (cart.length === 0) {
        cartItems.innerHTML = "<p>Seu carrinho está vazio.</p>";
        cartTotal.innerHTML = "";
        cartCount.textContent = "0";
        return;
      }

      let total = 0;
      let count = 0;

      cart.forEach((item, index) => {
        total += item.preco * item.quantidade;
        count += item.quantidade;
        cartItems.innerHTML += `
          <div>
            ${item.nome} - R$ ${item.preco.toFixed(2)} x ${item.quantidade}
            <button onclick="removeFromCart(${index})">❌</button>
          </div>
        `;
      });

      cartTotal.innerHTML = `<h3>Total: R$ ${total.toFixed(2)}</h3>`;
      cartCount.textContent = count;
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      renderCart();
    }

    // Adicionar ao carrinho
    document.querySelectorAll('.add-to-cart').forEach(btn => {
      btn.addEventListener('click', function() {
        const nome = this.dataset.nome;
        const preco = parseFloat(this.dataset.preco.replace(",", "."));
        const existing = cart.find(item => item.nome === nome);

        if (existing) {
          existing.quantidade += 1;
        } else {
          cart.push({ nome, preco, quantidade: 1 });
        }

        renderCart();
      });
    });

    function sendCartToWhatsApp() {
      if (cart.length === 0) {
        alert("Seu carrinho está vazio!");
        return;
      }

      let mensagem = "🛍️ Meu Pedido Bellafly:%0A%0A";
      let total = 0;

      cart.forEach(item => {
        mensagem += `• ${item.nome} - R$ ${item.preco.toFixed(2)} x ${item.quantidade}%0A`;
        total += item.preco * item.quantidade;
      });

      mensagem += `%0A💰 Total: R$ ${total.toFixed(2)}`;

      const telefone = "557981718236";
      const url = `https://wa.me/${telefone}?text=${mensagem}`;
      window.open(url, "_blank");
    }

    function toggleCart() {
      document.getElementById("cart-sidebar").classList.toggle("show");
      document.getElementById("cart-overlay").classList.toggle("show");
    }
    function clearCart() {
      if (confirm("Tem certeza que deseja limpar o carrinho?")) {
      cart = [];
      localStorage.removeItem("cart"); // remove do navegador
      renderCart(); // atualiza a interface
      }
    }


    // Inicializa carrinho
    renderCart();
  </script>
</body>
</html>
